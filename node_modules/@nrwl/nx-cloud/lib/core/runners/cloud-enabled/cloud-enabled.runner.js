const a1_0x154c=['env','uploads','map','indexOf','@nrwl/nx-cloud/lib/daemon/process-run-end','../../../utilities/environment','printCacheHitsMessage','value','cacheableOperations','./cloud-enabled-life-cycle','anyErrors','../../file-storage/e2e-encryption','pathExists','enabled','join','apply','cachePath','defineProperty','toISOString','cloudEnabledTasksRunner','taskId','writeFileSync','../../../utilities/metric-logger','Nx\x20Cloud\x20wasn\x27t\x20able\x20to\x20record\x20its\x20run.','getBranch','url','Nx\x20Cloud\x20Problems','Nx\x20Cloud\x20wasn\x27t\x20able\x20to\x20store\x20artifacts.','localhost','./cloud-run.api','encryptionKey','printMessages','ENCRYPTION_KEY','obfuscate','complete','tasks-hashes-','error','cacheDirectory','subscribe','daemon','stringify','ACCESS_TOKEN','./id-generator','fs-extra','../../terminal-output/end-of-run-message','FileStorage','.nx.app','endsWith','extractGitSha','../../terminal-output/output-obfuscator','runUrl','note','NX_CLOUD_DISTRIBUTED_EXECUTION_ID','processInBackground','endRun','done','assign','AGENT_RUNNING_IN_DISTRIBUTED_EXECUTION','https://nx.app','../../api/error-reporter.api','../../terminal-output/message-reporter','throw','submitRunMetrics','MessageReporter','../../../utilities/nx-imports','./cloud-remote-cache','api.nrwl.io','then','scan','skipNxCache','catch','__esModule','getRunGroup','accessToken','CloudEnabledLifeCycle','E2EEncryption','getMachineInfo','DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE','maskedProperties','Executed\x20tasks\x20with\x20hashes:\x20','length','ErrorReporterApi','next','lifeCycle','requests','filter','waitForStoreRequestsToComplete','../../file-storage/file-storage','hash','./node_modules/.cache/nx','.commit'];(function(_0x571903,_0x154cc9){const _0x42785c=function(_0x4c21dc){while(--_0x4c21dc){_0x571903['push'](_0x571903['shift']());}};_0x42785c(++_0x154cc9);}(a1_0x154c,0x1d2));const a1_0x4278=function(_0x571903,_0x154cc9){_0x571903=_0x571903-0x0;let _0x42785c=a1_0x154c[_0x571903];return _0x42785c;};'use strict';var __awaiter=this&&this['__awaiter']||function(_0x969374,_0x52d25a,_0x55eb34,_0xcc9f58){function _0x2d9c1d(_0x440911){return _0x440911 instanceof _0x55eb34?_0x440911:new _0x55eb34(function(_0x5c2b83){_0x5c2b83(_0x440911);});}return new(_0x55eb34||(_0x55eb34=Promise))(function(_0x1e560b,_0x19927f){function _0x3e19e2(_0x25407b){try{_0x2c37cd(_0xcc9f58['next'](_0x25407b));}catch(_0xb4eb01){_0x19927f(_0xb4eb01);}}function _0x26c524(_0x4a68a7){try{_0x2c37cd(_0xcc9f58[a1_0x4278('0x32')](_0x4a68a7));}catch(_0x41059f){_0x19927f(_0x41059f);}}function _0x2c37cd(_0x270705){_0x270705[a1_0x4278('0x2c')]?_0x1e560b(_0x270705[a1_0x4278('0x57')]):_0x2d9c1d(_0x270705[a1_0x4278('0x57')])[a1_0x4278('0x38')](_0x3e19e2,_0x26c524);}_0x2c37cd((_0xcc9f58=_0xcc9f58[a1_0x4278('0x4')](_0x969374,_0x52d25a||[]))[a1_0x4278('0x47')]());});};Object[a1_0x4278('0x6')](exports,a1_0x4278('0x3c'),{'value':!![]});exports['cloudEnabledTasksRunner']=void 0x0;const message_reporter_1=require(a1_0x4278('0x31'));const end_of_run_message_1=require(a1_0x4278('0x21'));const output_obfuscator_1=require(a1_0x4278('0x26'));const cloud_enabled_life_cycle_1=require(a1_0x4278('0x59'));const file_storage_1=require(a1_0x4278('0x4c'));const e2e_encryption_1=require(a1_0x4278('0x0'));const environment_1=require(a1_0x4278('0x55'));const cloud_remote_cache_1=require(a1_0x4278('0x36'));const cloud_run_api_1=require(a1_0x4278('0x12'));const fs_1=require('fs');const path=require('path');const metric_logger_1=require(a1_0x4278('0xb'));const error_reporter_api_1=require(a1_0x4278('0x30'));const path_1=require('path');const fs_extra_1=require(a1_0x4278('0x20'));const id_generator_1=require(a1_0x4278('0x1f'));const {tasksRunner,output,Cache}=require(a1_0x4278('0x35'));function createApi(_0x565d58,_0x3d922f,_0x373304){const _0x39a598=(0x0,environment_1[a1_0x4278('0x41')])(_0x3d922f);return new cloud_run_api_1['CloudRunApi'](_0x565d58,_0x373304,_0x3d922f,_0x39a598);}function storeTaskHashes(_0x51aef5,_0x8fa494,_0x1d31a8){const _0x352087=JSON[a1_0x4278('0x1d')](_0x51aef5[a1_0x4278('0x52')](_0x124a37=>({'taskId':_0x124a37[a1_0x4278('0x9')],'hash':_0x124a37[a1_0x4278('0x4d')]})));if(environment_1['VERBOSE_LOGGING']){output[a1_0x4278('0x28')]({'title':a1_0x4278('0x44')+_0x352087});}(0x0,fs_1[a1_0x4278('0xa')])(path['join'](_0x8fa494,a1_0x4278('0x18')+_0x1d31a8),_0x352087);}function onComplete({daemon,lifeCycle,options,remoteCache,api,outputObfuscator,runStartTime,messages,endOfRunMessage,taskExecutions,versionOfNxBefore133,inner,encryptionKey,fileStorage,uploadInCurrentProcess,runContext}){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x257720=new Date()[a1_0x4278('0x7')]();const _0x24dc40=(0x0,environment_1[a1_0x4278('0xd')])();const _0x100f50={'command':outputObfuscator[a1_0x4278('0x16')]((0x0,environment_1['parseCommand'])()),'startTime':runStartTime,'endTime':_0x257720,'distributedExecutionId':environment_1[a1_0x4278('0x29')],'branch':_0x24dc40,'scan':!![],'runGroup':(0x0,environment_1[a1_0x4278('0x3d')])(),'sha':_0x24dc40?(0x0,environment_1[a1_0x4278('0x25')])():undefined,'inner':inner};if(uploadInCurrentProcess){if(environment_1[a1_0x4278('0x2e')]){storeTaskHashes(taskExecutions,options['cacheDirectory']||a1_0x4278('0x4e'),environment_1[a1_0x4278('0x29')]);}try{yield remoteCache[a1_0x4278('0x4b')]();}catch(_0x4874fc){output[a1_0x4278('0x19')]({'title':a1_0x4278('0x10')});messages['printMessages']();process['exit'](environment_1[a1_0x4278('0x42')]);}try{yield api[a1_0x4278('0x2b')](_0x100f50,taskExecutions);}catch(_0x8a3936){output[a1_0x4278('0x19')]({'title':a1_0x4278('0xc')});messages[a1_0x4278('0x14')]();process['exit'](environment_1['DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE']);}yield(0x0,metric_logger_1[a1_0x4278('0x33')])(options);}else{try{const _0x14e471=environment_1[a1_0x4278('0x1e')]?environment_1[a1_0x4278('0x1e')]:options[a1_0x4278('0x3e')];const _0x211741=(0x0,id_generator_1['generateUniqueLinkId'])();yield daemon[a1_0x4278('0x2a')](a1_0x4278('0x54'),{'encryptionKey':encryptionKey,'runnerOptions':Object[a1_0x4278('0x2d')](Object[a1_0x4278('0x2d')]({},options),{'accessToken':_0x14e471}),'uploads':fileStorage[a1_0x4278('0x51')],'runEnd':{'runData':_0x100f50,'taskExecutions':taskExecutions,'linkId':_0x211741}});runContext[a1_0x4278('0x27')]=(options[a1_0x4278('0xe')]||a1_0x4278('0x2f'))+'/runs/'+_0x211741;}catch(_0x483b36){output['warn']({'title':a1_0x4278('0xf'),'bodyLines':[_0x483b36['message']||_0x483b36['toString']()]});}}if(versionOfNxBefore133){setTimeout(()=>{messages[a1_0x4278('0x14')]();if(!messages[a1_0x4278('0x5a')]&&!inner){endOfRunMessage['printCacheHitsMessage']();}},0x0);}else{messages[a1_0x4278('0x14')]();if(!messages[a1_0x4278('0x5a')]&&!inner){endOfRunMessage[a1_0x4278('0x56')]();}}});}function createLifeCycle(_0x25e98c,_0x114a80,_0x40339c,_0x4bfd9e){const _0x41e1f6=new cloud_enabled_life_cycle_1[(a1_0x4278('0x3f'))](_0x25e98c,_0x114a80[a1_0x4278('0x1a')],!!_0x114a80[a1_0x4278('0x3a')],_0x114a80['scan']===undefined?!![]:_0x114a80[a1_0x4278('0x39')],_0x114a80[a1_0x4278('0x58')]||[],_0x40339c,_0x4bfd9e);try{const {CompositeLifeCycle}=require(a1_0x4278('0x35'));if(!CompositeLifeCycle)return _0x41e1f6;return new CompositeLifeCycle([_0x114a80['lifeCycle'],_0x41e1f6]);}catch(_0x4c8aab){return _0x41e1f6;}}function fetchUrlsForKnownHashesUpfront(_0x1bfa5e,_0x3d4f7f,_0x17e2c2,_0x47082c){return __awaiter(this,void 0x0,void 0x0,function*(){let _0x379cc5=_0x17e2c2[a1_0x4278('0x52')](_0x5c4cfe=>_0x5c4cfe[a1_0x4278('0x4d')])[a1_0x4278('0x4a')](_0x28299f=>!!_0x28299f);const _0x5c01f6=new Cache(_0x47082c);if(!_0x47082c['skipNxCache']){const _0x4253dc=yield Promise['all'](_0x379cc5['map'](_0x2fc98b=>{const _0x8a1b04=(0x0,path_1[a1_0x4278('0x3')])(_0x5c01f6[a1_0x4278('0x5')],_0x2fc98b+a1_0x4278('0x4f'));return(0x0,fs_extra_1[a1_0x4278('0x1')])(_0x8a1b04);}));const _0x26bcc0=[];for(let _0xb5a5a8=0x0;_0xb5a5a8<_0x4253dc[a1_0x4278('0x45')];++_0xb5a5a8){if(_0x4253dc[_0xb5a5a8]){_0x26bcc0['push'](_0x379cc5[_0xb5a5a8]);}}_0x379cc5=_0x26bcc0;}if(_0x379cc5[a1_0x4278('0x45')]>0x0){const _0x5eeb94=_0x1bfa5e['startRun'](environment_1['NX_CLOUD_DISTRIBUTED_EXECUTION_ID'],_0x379cc5);for(const _0x20b41 of _0x379cc5){_0x3d4f7f[a1_0x4278('0x49')][_0x20b41]=_0x5eeb94;}}});}function isConnectedToPrivateCloud(_0x2d7f26){if(!_0x2d7f26[a1_0x4278('0xe')])return![];if(_0x2d7f26[a1_0x4278('0xe')][a1_0x4278('0x24')](a1_0x4278('0x37')))return![];if(_0x2d7f26[a1_0x4278('0xe')]['endsWith'](a1_0x4278('0x23')))return![];if(_0x2d7f26[a1_0x4278('0xe')][a1_0x4278('0x53')](a1_0x4278('0x11'))>-0x1)return![];return!![];}function cloudEnabledTasksRunner(_0x3314c8,_0x388ed5,_0x15b16f,_0x5b7533=![]){var _0x4ee041;const _0xc1f823={'statuses':{},'scheduledTasks':[],'requests':{},'allTasks':_0x3314c8};const _0x20a09f=_0x388ed5[a1_0x4278('0x48')]===undefined;const _0x42d96c=[];const _0xcaf623=new message_reporter_1[(a1_0x4278('0x34'))](_0x388ed5);const _0x483533=createApi(_0xcaf623,_0x388ed5,_0xc1f823);const _0xced1d6=new end_of_run_message_1['EndOfRunMessage'](_0xc1f823,_0x42d96c);const _0x16a79c=new output_obfuscator_1['OutputObfuscator'](_0x388ed5[a1_0x4278('0x43')]);const _0xf1c4ba=new Date()[a1_0x4278('0x7')]();const _0x234bb9=createLifeCycle(_0xc1f823,_0x388ed5,_0x16a79c,_0x42d96c);const _0x392e27=environment_1[a1_0x4278('0x15')]||_0x388ed5[a1_0x4278('0x13')];const _0x2ebc7b=new e2e_encryption_1[(a1_0x4278('0x40'))](_0x392e27);const _0x312f53=new error_reporter_api_1[(a1_0x4278('0x46'))](_0x388ed5);const _0x289672=!!environment_1[a1_0x4278('0x2e')]||!((_0x4ee041=_0x15b16f['daemon'])===null||_0x4ee041===void 0x0?void 0x0:_0x4ee041[a1_0x4278('0x2')]())||isConnectedToPrivateCloud(_0x388ed5);const _0x4aa72f=new file_storage_1[(a1_0x4278('0x22'))](_0x2ebc7b,_0x312f53,![],_0x289672);const _0x53ee25=new cloud_remote_cache_1['CloudRemoteCache'](_0xcaf623,_0x483533,_0xc1f823,_0x4aa72f);fetchUrlsForKnownHashesUpfront(_0x483533,_0xc1f823,_0x3314c8,_0x388ed5);delete process[a1_0x4278('0x50')][a1_0x4278('0x29')];const _0x27bfc9=tasksRunner(_0x3314c8,Object[a1_0x4278('0x2d')](Object[a1_0x4278('0x2d')]({},_0x388ed5),{'remoteCache':_0x53ee25,'lifeCycle':_0x234bb9}),_0x15b16f);if(_0x27bfc9[a1_0x4278('0x1b')]){const {Subject}=require('rxjs/internal/Subject');const _0x24d96b=new Subject();_0x27bfc9['subscribe']({'next':_0x100b0b=>_0x24d96b['next'](_0x100b0b),'error':_0x73fc46=>_0x24d96b[a1_0x4278('0x19')](_0x73fc46),'complete':()=>__awaiter(this,void 0x0,void 0x0,function*(){yield onComplete({'daemon':_0x15b16f[a1_0x4278('0x1c')],'lifeCycle':_0x234bb9,'options':_0x388ed5,'remoteCache':_0x53ee25,'api':_0x483533,'outputObfuscator':_0x16a79c,'runStartTime':_0xf1c4ba,'messages':_0xcaf623,'endOfRunMessage':_0xced1d6,'taskExecutions':_0x42d96c,'versionOfNxBefore133':_0x20a09f,'inner':_0x5b7533,'encryptionKey':_0x392e27,'fileStorage':_0x4aa72f,'uploadInCurrentProcess':_0x289672,'runContext':_0xc1f823});_0x24d96b[a1_0x4278('0x17')]();})});return _0x24d96b;}else{return _0x27bfc9[a1_0x4278('0x38')](_0xc0134b=>__awaiter(this,void 0x0,void 0x0,function*(){yield onComplete({'daemon':_0x15b16f['daemon'],'lifeCycle':_0x234bb9,'options':_0x388ed5,'remoteCache':_0x53ee25,'api':_0x483533,'outputObfuscator':_0x16a79c,'runStartTime':_0xf1c4ba,'messages':_0xcaf623,'endOfRunMessage':_0xced1d6,'taskExecutions':_0x42d96c,'versionOfNxBefore133':_0x20a09f,'inner':_0x5b7533,'encryptionKey':_0x392e27,'fileStorage':_0x4aa72f,'uploadInCurrentProcess':_0x289672,'runContext':_0xc1f823});return _0xc0134b;}))[a1_0x4278('0x3b')](_0x5529f6=>__awaiter(this,void 0x0,void 0x0,function*(){yield onComplete({'daemon':_0x15b16f[a1_0x4278('0x1c')],'lifeCycle':_0x234bb9,'options':_0x388ed5,'remoteCache':_0x53ee25,'api':_0x483533,'outputObfuscator':_0x16a79c,'runStartTime':_0xf1c4ba,'messages':_0xcaf623,'endOfRunMessage':_0xced1d6,'taskExecutions':_0x42d96c,'versionOfNxBefore133':_0x20a09f,'inner':_0x5b7533,'encryptionKey':_0x392e27,'fileStorage':_0x4aa72f,'uploadInCurrentProcess':_0x289672,'runContext':_0xc1f823});throw _0x5529f6;}));}}exports[a1_0x4278('0x8')]=cloudEnabledTasksRunner;