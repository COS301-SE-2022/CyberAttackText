const a3_0x409b=['apiAxiosInstance','apiError','message','length','headers','string','throw','assign','toString','post','../../../utilities/nx-imports','terminalOutput','status','RunEnd\x20duration','createMetricRecorder','promisify','axiosException','endRun','value','createApiAxiosInstance','RunEnd.\x20Completed\x20tasks','slice','success','axiosMultipleTries','error','Run\x20completion\x20responded\x20with\x20`undefined`.','defaults','/nx-cloud/runs/end','RunStart\x20duration','Run\x20Details:','@nrwl/nx-cloud','runContext','api','/nx-cloud/runs/start','Stack\x20Trace:','../../../utilities/metric-logger','done','RUNNER_FAILURE_PERF_ENTRY','gzip','printDuration','startRun','extractErrorMessage','readFileSync','__esModule','note','VERBOSE_LOGGING','stack','recordMetric','runUrl','Invalid\x20end\x20run\x20response:\x20','Nx\x20Cloud:\x20Unknown\x20Error\x20Occurred','...','parse','getRunGroup','unknown','urls','createReqBody','defineProperty','map','nxCloudVersion','messages','from','data','Invalid\x20Nx\x20Cloud\x20response:\x20','CloudRunApi','package.json','stringify','mapRespToPerfEntry','next'];(function(_0x278ef2,_0x409b8a){const _0x2578c8=function(_0x591ee8){while(--_0x591ee8){_0x278ef2['push'](_0x278ef2['shift']());}};_0x2578c8(++_0x409b8a);}(a3_0x409b,0x10a));const a3_0x2578=function(_0x278ef2,_0x409b8a){_0x278ef2=_0x278ef2-0x0;let _0x2578c8=a3_0x409b[_0x278ef2];return _0x2578c8;};'use strict';var __awaiter=this&&this['__awaiter']||function(_0x3d49d5,_0x417fc9,_0x2303da,_0x4508e6){function _0x1be03b(_0x4ba446){return _0x4ba446 instanceof _0x2303da?_0x4ba446:new _0x2303da(function(_0x4fa2f1){_0x4fa2f1(_0x4ba446);});}return new(_0x2303da||(_0x2303da=Promise))(function(_0x48e9f6,_0x262a76){function _0x900137(_0xc791cd){try{_0x4d59f5(_0x4508e6[a3_0x2578('0x9')](_0xc791cd));}catch(_0x1508df){_0x262a76(_0x1508df);}}function _0x50b85e(_0x41dcf0){try{_0x4d59f5(_0x4508e6[a3_0x2578('0x10')](_0x41dcf0));}catch(_0x545c22){_0x262a76(_0x545c22);}}function _0x4d59f5(_0x39e98e){_0x39e98e[a3_0x2578('0x2e')]?_0x48e9f6(_0x39e98e[a3_0x2578('0x1c')]):_0x1be03b(_0x39e98e[a3_0x2578('0x1c')])['then'](_0x900137,_0x50b85e);}_0x4d59f5((_0x4508e6=_0x4508e6['apply'](_0x3d49d5,_0x417fc9||[]))['next']());});};Object[a3_0x2578('0x43')](exports,a3_0x2578('0x35'),{'value':!![]});exports[a3_0x2578('0x5')]=void 0x0;const axios_1=require('../../../utilities/axios');const environment_1=require('../../../utilities/environment');const fs_1=require('fs');const zlib_1=require('zlib');const util_1=require('util');const metric_logger_1=require(a3_0x2578('0x2d'));const {output}=require(a3_0x2578('0x14'));class CloudRunApi{constructor(_0x52d6d5,_0x2fc9ce,_0x131a4a,_0x2d0b02){this[a3_0x2578('0x1')]=_0x52d6d5;this[a3_0x2578('0x29')]=_0x2fc9ce;this['machineInfo']=_0x2d0b02;this['apiAxiosInstance']=(0x0,axios_1[a3_0x2578('0x1d')])(_0x131a4a);}[a3_0x2578('0x32')](_0x364135,_0x4b1cc3){var _0x5854fb;return __awaiter(this,void 0x0,void 0x0,function*(){const _0x213594=(0x0,metric_logger_1['createMetricRecorder'])(a3_0x2578('0x32'));try{const _0x362307={'meta':{'nxCloudVersion':this['nxCloudVersion']()},'branch':(0x0,environment_1['getBranch'])(),'runGroup':(0x0,environment_1[a3_0x2578('0x3f')])(),'distributedExecutionId':_0x364135,'hashes':_0x4b1cc3};if(environment_1['VERBOSE_LOGGING']){output[a3_0x2578('0x36')]({'title':'RunStart','bodyLines':['\x0a'+JSON[a3_0x2578('0x7')](_0x362307,null,0x2)]});}const _0x2ecc5e=yield(0x0,axios_1[a3_0x2578('0x31')])(a3_0x2578('0x26'),()=>(0x0,axios_1[a3_0x2578('0x21')])(()=>this['apiAxiosInstance'][a3_0x2578('0x13')](a3_0x2578('0x2b'),_0x362307)));_0x213594['recordMetric']((0x0,metric_logger_1[a3_0x2578('0x8')])(_0x2ecc5e));if(_0x2ecc5e[a3_0x2578('0x3')]&&_0x2ecc5e[a3_0x2578('0x3')][a3_0x2578('0xc')]){this[a3_0x2578('0x1')][a3_0x2578('0xc')]=_0x2ecc5e[a3_0x2578('0x3')][a3_0x2578('0xc')];}if(!_0x2ecc5e['data']||!_0x2ecc5e[a3_0x2578('0x3')][a3_0x2578('0x41')]){this['messages']['apiError']=a3_0x2578('0x4')+JSON['stringify'](_0x2ecc5e[a3_0x2578('0x3')]);return{};}return _0x2ecc5e['data']['urls'];}catch(_0x555dcf){_0x213594[a3_0x2578('0x39')](((_0x5854fb=_0x555dcf===null||_0x555dcf===void 0x0?void 0x0:_0x555dcf[a3_0x2578('0x1a')])===null||_0x5854fb===void 0x0?void 0x0:_0x5854fb['response'])?(0x0,metric_logger_1['mapRespToPerfEntry'])(_0x555dcf[a3_0x2578('0x1a')]['response']):metric_logger_1['RUNNER_FAILURE_PERF_ENTRY']);this[a3_0x2578('0x1')]['apiError']=this[a3_0x2578('0x1')][a3_0x2578('0x33')](_0x555dcf,'api');return{};}});}[a3_0x2578('0x42')](_0x3d84da,_0x501863,_0x1d1fcb){const _0x21ed52={'meta':{'nxCloudVersion':this[a3_0x2578('0x0')]()},'tasks':_0x501863,'run':_0x3d84da,'linkId':_0x1d1fcb,'machineInfo':this['machineInfo']};return JSON[a3_0x2578('0x7')](_0x21ed52);}['endRun'](_0x59d52e,_0x4fca4a,_0x9398ed){var _0x2bd655,_0x292b96;return __awaiter(this,void 0x0,void 0x0,function*(){if(this[a3_0x2578('0x1')][a3_0x2578('0xb')])return![];let _0x181330=this[a3_0x2578('0x42')](_0x59d52e,_0x4fca4a,_0x9398ed);if(_0x181330[a3_0x2578('0xd')]>0x14*0x3e8*0x3e8){_0x181330=this[a3_0x2578('0x42')](_0x59d52e,_0x4fca4a[a3_0x2578('0x44')](_0x360365=>Object['assign'](Object[a3_0x2578('0x11')]({},_0x360365),{'hashDetails':undefined})));}const _0x1e3694=Buffer[a3_0x2578('0x2')](_0x181330);const _0x292811=yield(0x0,util_1[a3_0x2578('0x19')])(zlib_1['gzip'])(_0x1e3694);const _0x248c42=(0x0,metric_logger_1[a3_0x2578('0x18')])(a3_0x2578('0x1b'));try{if(environment_1[a3_0x2578('0x37')]){const _0x6313d5=_0x4fca4a['map'](_0x5a0ff5=>{return Object[a3_0x2578('0x11')](Object[a3_0x2578('0x11')]({},_0x5a0ff5),{'terminalOutput':_0x5a0ff5[a3_0x2578('0x15')]?_0x5a0ff5[a3_0x2578('0x15')][a3_0x2578('0x1f')](0x0,0x14)+a3_0x2578('0x3d'):undefined});});output[a3_0x2578('0x36')]({'title':a3_0x2578('0x1e'),'bodyLines':['\x0a'+JSON[a3_0x2578('0x7')](_0x6313d5,null,0x2)]});}const _0x281bd8=yield(0x0,axios_1['printDuration'])(a3_0x2578('0x17'),()=>(0x0,axios_1['axiosMultipleTries'])(()=>this['apiAxiosInstance']['post'](a3_0x2578('0x25'),_0x292811,{'headers':Object[a3_0x2578('0x11')](Object[a3_0x2578('0x11')]({},this[a3_0x2578('0xa')][a3_0x2578('0x24')][a3_0x2578('0xe')]),{'Content-Encoding':a3_0x2578('0x30'),'Content-Type':'application/octet-stream'})})));if(_0x281bd8){_0x248c42[a3_0x2578('0x39')]((0x0,metric_logger_1[a3_0x2578('0x8')])(_0x281bd8));if(_0x281bd8[a3_0x2578('0x3')]&&_0x281bd8[a3_0x2578('0x3')][a3_0x2578('0x3a')]&&_0x281bd8[a3_0x2578('0x3')][a3_0x2578('0x16')]==='success'){this[a3_0x2578('0x29')][a3_0x2578('0x3a')]=_0x281bd8[a3_0x2578('0x3')][a3_0x2578('0x3a')];return!![];}if(_0x281bd8[a3_0x2578('0x3')]&&_0x281bd8[a3_0x2578('0x3')]['status']){this[a3_0x2578('0x1')][a3_0x2578('0xb')]=a3_0x2578('0x3b')+JSON[a3_0x2578('0x7')](_0x281bd8['data'][a3_0x2578('0xc')]);}else if(_0x281bd8[a3_0x2578('0x3')]&&typeof _0x281bd8[a3_0x2578('0x3')]===a3_0x2578('0xf')){if(_0x281bd8[a3_0x2578('0x3')]!==a3_0x2578('0x20')){this['messages']['apiError']=a3_0x2578('0x3b')+JSON[a3_0x2578('0x7')](_0x281bd8['data']);}}else{this['messages'][a3_0x2578('0xb')]=a3_0x2578('0x3b')+JSON[a3_0x2578('0x7')](_0x281bd8[a3_0x2578('0x3')]);}if(environment_1[a3_0x2578('0x37')]){output[a3_0x2578('0x36')]({'title':'Invalid\x20end\x20run\x20response','bodyLines':[JSON[a3_0x2578('0x7')](_0x281bd8[a3_0x2578('0x3')],null,0x2)]});}}else{output[a3_0x2578('0x22')]({'title':a3_0x2578('0x3c'),'bodyLines':[a3_0x2578('0x23'),a3_0x2578('0x27'),JSON['stringify'](_0x59d52e,null,0x2),a3_0x2578('0x2c'),JSON[a3_0x2578('0x7')](new Error()[a3_0x2578('0x38')],null,0x2)]});}return![];}catch(_0x37d835){_0x248c42['recordMetric'](((_0x2bd655=_0x37d835===null||_0x37d835===void 0x0?void 0x0:_0x37d835[a3_0x2578('0x1a')])===null||_0x2bd655===void 0x0?void 0x0:_0x2bd655['response'])?(0x0,metric_logger_1['mapRespToPerfEntry'])(_0x37d835[a3_0x2578('0x1a')]['response']):metric_logger_1[a3_0x2578('0x2f')]);const _0x4dc930=(_0x292b96=_0x37d835[a3_0x2578('0x1a')])!==null&&_0x292b96!==void 0x0?_0x292b96:_0x37d835;this['messages'][a3_0x2578('0xb')]=this['messages'][a3_0x2578('0x33')](_0x4dc930,a3_0x2578('0x2a'));return![];}});}['nxCloudVersion'](){try{const _0x5eb3f8=JSON[a3_0x2578('0x3e')]((0x0,fs_1[a3_0x2578('0x34')])(a3_0x2578('0x6'))[a3_0x2578('0x12')]());return _0x5eb3f8['devDependencies'][a3_0x2578('0x28')];}catch(_0xc8f6b8){return a3_0x2578('0x40');}}}exports['CloudRunApi']=CloudRunApi;