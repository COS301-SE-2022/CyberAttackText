const a7_0x4a1b=['parseCommand','completeRunGroupWithError','error','throw','apiAxiosInstance','../../../utilities/metric-logger','true','post','__esModule','/nx-cloud/executions/status','NX_CLOUD_DISTRIBUTED_EXECUTION_AGENT_COUNT','serializeOverrides','/nx-cloud/executions/start','axiosMultipleTries','DistributedExecutionApi','then','../../../utilities/serializer-overrides','../../../utilities/axios','../../../utilities/environment','dteStatus','VERBOSE_LOGGING','next','dteStart','start','response','apply','runGroup:\x20','exit','defineProperty','recordMetric','NX_CLOUD_DISTRIBUTED_EXECUTION_STOP_AGENTS_ON_FAILURE','stopAgentsOnFailure','axiosException','note','project','stringify','../../../utilities/nx-imports','hash','configuration','getBranch','parallel','__awaiter','done','mapRespToPerfEntry','map','false','target','createStartRequest','maxParallel','message','RUNNER_FAILURE_PERF_ENTRY','createMetricRecorder','data','value','status'];(function(_0xd4a897,_0x4a1bc0){const _0x5aca62=function(_0x3d1851){while(--_0x3d1851){_0xd4a897['push'](_0xd4a897['shift']());}};_0x5aca62(++_0x4a1bc0);}(a7_0x4a1b,0x9b));const a7_0x5aca=function(_0xd4a897,_0x4a1bc0){_0xd4a897=_0xd4a897-0x0;let _0x5aca62=a7_0x4a1b[_0xd4a897];return _0x5aca62;};'use strict';var __awaiter=this&&this[a7_0x5aca('0x33')]||function(_0x3ae434,_0x34da32,_0x42726c,_0x65099d){function _0x5ea095(_0x5e372b){return _0x5e372b instanceof _0x42726c?_0x5e372b:new _0x42726c(function(_0x316240){_0x316240(_0x5e372b);});}return new(_0x42726c||(_0x42726c=Promise))(function(_0x1a0e1b,_0x27711d){function _0x361db9(_0x475937){try{_0x166887(_0x65099d[a7_0x5aca('0x1f')](_0x475937));}catch(_0x394b1e){_0x27711d(_0x394b1e);}}function _0x2db00d(_0x4984af){try{_0x166887(_0x65099d[a7_0x5aca('0xd')](_0x4984af));}catch(_0x428c43){_0x27711d(_0x428c43);}}function _0x166887(_0x392041){_0x392041[a7_0x5aca('0x34')]?_0x1a0e1b(_0x392041['value']):_0x5ea095(_0x392041[a7_0x5aca('0x8')])[a7_0x5aca('0x19')](_0x361db9,_0x2db00d);}_0x166887((_0x65099d=_0x65099d[a7_0x5aca('0x23')](_0x3ae434,_0x34da32||[]))[a7_0x5aca('0x1f')]());});};Object[a7_0x5aca('0x26')](exports,a7_0x5aca('0x12'),{'value':!![]});exports[a7_0x5aca('0x2')]=exports[a7_0x5aca('0x18')]=void 0x0;const axios_1=require(a7_0x5aca('0x1b'));const environment_1=require(a7_0x5aca('0x1c'));const metric_logger_1=require(a7_0x5aca('0xf'));const serializer_overrides_1=require(a7_0x5aca('0x1a'));const {output}=require(a7_0x5aca('0x2e'));class DistributedExecutionApi{constructor(_0x2345b0){this[a7_0x5aca('0xe')]=(0x0,axios_1['createApiAxiosInstance'])(_0x2345b0);}[a7_0x5aca('0x21')](_0x45de04){var _0x3229cc;return __awaiter(this,void 0x0,void 0x0,function*(){const _0x17132a=(0x0,metric_logger_1[a7_0x5aca('0x6')])(a7_0x5aca('0x20'));let _0x4e1566;if(environment_1[a7_0x5aca('0x1e')]){output[a7_0x5aca('0x2b')]({'title':'Starting\x20a\x20distributed\x20execution','bodyLines':[JSON[a7_0x5aca('0x2d')](_0x45de04,null,0x2)]});}try{_0x4e1566=yield(0x0,axios_1['axiosMultipleTries'])(()=>this[a7_0x5aca('0xe')]['post'](a7_0x5aca('0x16'),_0x45de04));_0x17132a['recordMetric']((0x0,metric_logger_1[a7_0x5aca('0x35')])(_0x4e1566));}catch(_0x24809a){_0x17132a[a7_0x5aca('0x27')](((_0x3229cc=_0x24809a===null||_0x24809a===void 0x0?void 0x0:_0x24809a[a7_0x5aca('0x2a')])===null||_0x3229cc===void 0x0?void 0x0:_0x3229cc['response'])?(0x0,metric_logger_1['mapRespToPerfEntry'])(_0x24809a['axiosException']['response']):metric_logger_1[a7_0x5aca('0x5')]);throw _0x24809a;}if(!_0x4e1566[a7_0x5aca('0x7')]['enabled']){throw new Error('Workspace\x20is\x20disabled.\x20Cannot\x20perform\x20distributed\x20task\x20executions.');}if(_0x4e1566[a7_0x5aca('0x7')][a7_0x5aca('0xc')]){throw new Error(_0x4e1566[a7_0x5aca('0x7')][a7_0x5aca('0xc')]);}return _0x4e1566['data']['id'];});}[a7_0x5aca('0x9')](_0x1e273e){var _0x127f1d;return __awaiter(this,void 0x0,void 0x0,function*(){const _0x1659d7=(0x0,metric_logger_1['createMetricRecorder'])(a7_0x5aca('0x1d'));try{const _0x380eaa=yield(0x0,axios_1[a7_0x5aca('0x17')])(()=>this[a7_0x5aca('0xe')][a7_0x5aca('0x11')](a7_0x5aca('0x13'),{'id':_0x1e273e}));_0x1659d7['recordMetric']((0x0,metric_logger_1[a7_0x5aca('0x35')])(_0x380eaa));return _0x380eaa[a7_0x5aca('0x7')];}catch(_0x3779de){_0x1659d7[a7_0x5aca('0x27')](((_0x127f1d=_0x3779de===null||_0x3779de===void 0x0?void 0x0:_0x3779de[a7_0x5aca('0x2a')])===null||_0x127f1d===void 0x0?void 0x0:_0x127f1d[a7_0x5aca('0x22')])?(0x0,metric_logger_1[a7_0x5aca('0x35')])(_0x3779de[a7_0x5aca('0x2a')][a7_0x5aca('0x22')]):metric_logger_1[a7_0x5aca('0x5')]);output[a7_0x5aca('0xc')]({'title':_0x3779de[a7_0x5aca('0x4')]});process[a7_0x5aca('0x25')](0x1);}});}[a7_0x5aca('0xb')](_0x2ce206,_0x16a95f){var _0x7659b9;return __awaiter(this,void 0x0,void 0x0,function*(){const _0xb238d1=(0x0,metric_logger_1['createMetricRecorder'])('completeRunGroup');if(environment_1['VERBOSE_LOGGING']){output['note']({'title':'Completing\x20run\x20group\x20with\x20an\x20error','bodyLines':[a7_0x5aca('0x24')+_0x2ce206,'error:\x20'+_0x16a95f]});}try{const _0x53d2be=yield(0x0,axios_1[a7_0x5aca('0x17')])(()=>this[a7_0x5aca('0xe')][a7_0x5aca('0x11')]('/nx-cloud/executions/complete-run-group',{'runGroup':_0x2ce206,'criticalErrorMessage':_0x16a95f}),0x3);_0xb238d1[a7_0x5aca('0x27')]((0x0,metric_logger_1['mapRespToPerfEntry'])(_0x53d2be));}catch(_0x4d4a2f){_0xb238d1[a7_0x5aca('0x27')](((_0x7659b9=_0x4d4a2f===null||_0x4d4a2f===void 0x0?void 0x0:_0x4d4a2f['axiosException'])===null||_0x7659b9===void 0x0?void 0x0:_0x7659b9['response'])?(0x0,metric_logger_1[a7_0x5aca('0x35')])(_0x4d4a2f[a7_0x5aca('0x2a')][a7_0x5aca('0x22')]):metric_logger_1['RUNNER_FAILURE_PERF_ENTRY']);}});}}exports[a7_0x5aca('0x18')]=DistributedExecutionApi;function createStartRequest(_0x324e55,_0x24fd59,_0x5569e7){const _0x44f794=_0x24fd59[a7_0x5aca('0x36')](_0x5f42e8=>{return _0x5f42e8['map'](_0xe18302=>{return{'taskId':_0xe18302['id'],'hash':_0xe18302[a7_0x5aca('0x2f')],'projectName':_0xe18302['target'][a7_0x5aca('0x2c')],'target':_0xe18302['target'][a7_0x5aca('0x1')],'configuration':_0xe18302[a7_0x5aca('0x1')][a7_0x5aca('0x30')]||null,'params':(0x0,serializer_overrides_1[a7_0x5aca('0x15')])(_0xe18302)};});});const _0x1723c9={'command':(0x0,environment_1[a7_0x5aca('0xa')])(),'branch':(0x0,environment_1[a7_0x5aca('0x31')])(),'runGroup':_0x324e55,'tasks':_0x44f794,'maxParallel':calculateMaxParallel(_0x5569e7)};if(environment_1['NX_CLOUD_DISTRIBUTED_EXECUTION_AGENT_COUNT']){_0x1723c9['agentCount']=environment_1[a7_0x5aca('0x14')];}if(!environment_1[a7_0x5aca('0x28')]){_0x1723c9[a7_0x5aca('0x29')]=![];}return _0x1723c9;}exports['createStartRequest']=createStartRequest;function calculateMaxParallel(_0xe17f41){if(_0xe17f41[a7_0x5aca('0x32')]===a7_0x5aca('0x0')||_0xe17f41['parallel']===![]){return 0x1;}else if(_0xe17f41[a7_0x5aca('0x32')]===a7_0x5aca('0x10')||_0xe17f41[a7_0x5aca('0x32')]===!![]){return Number(_0xe17f41[a7_0x5aca('0x3')]||0x3);}else if(_0xe17f41[a7_0x5aca('0x32')]===undefined){return _0xe17f41[a7_0x5aca('0x3')]?Number(_0xe17f41['maxParallel']):0x3;}else{return Number(_0xe17f41[a7_0x5aca('0x32')])||0x3;}}